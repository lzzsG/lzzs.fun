# 表达式求值相关

可能用到的工具：[原反补码相互转换](https://www.23bei.com/tool/56.html?)、[RegexLearn playground](https://regexlearn.com/zh-cn/playground)、Ubuntu自带的计算器、[表达式计算器](https://toolwa.com/free-calc/)

## 表达式示例

```c
// 正确寄存器
$0 $ra $sp $gp $tp $t0 $t1 $t2 $s0 $s1 $a0 $a1 $a2 $a3 $a4 $a5 $a6 $a7 $s2 $s3 $s4 $s5 $s6 $s7 $s8 $s9 $s10 $s11 $t3 $t4 $t5 $t6 $pc 

// 错误寄存器
$00 $ra0 $sp1 $gp0 $tp2 $t7 $s12 $a8 $b1 $pc0 $t $a $s13 $ra2 $x1 $r0 $10 $spx  $00 $ra0 $sp1 $gp0 $tp2 $t7 $s12 $a8 $b1 $pc0 $t $a $s13 $ra2 $x1 $r0 $10 $spx $t10 $a10 $s-1 $ax $ta $sp_
  
// 正确的十六进制实例
0x0 0x1A 0xFF 0x1234 0xabcdef 0xABCDEF 0x10 0x7B 0xBEEF 0xCAFE 0xdeadbeef 0x100000 0X3F 0X1A2B 0XABC 0x9 0x00 

// 错误的十六进制实例
0xGHIJK 0x123G 0x1.2 0xABC.Z 0X 123 0x-ABC x123 0x 0xZZ 0x123 456 0xFFGG 0x123GHI 0x..123 0x123. 0x12_34 0x+12 

//表达式示例
((5 + 3) * (2 + 2)) - 10
15 - (3 + (4 * 2) - (6 / 2))
((0xA + 5) * (0x3 - 2)) + 10
(7 + (0x5 * (3 + 2))) - (10 / (2 + 3))
(8 + (3 * (4 - 1))) * ((2 + 3) - 1)
  
 // 错误表达式
```

1. **未闭合的括号**

   ```c
   (5 + 3 * (2 - 1) + 4 * (6 - 2
   ```

2. **多余的括号**

   ```c
   10 - (3 + 4)) * 2
   ```

3. **多余的运算符**

   ```c
   5 + * 3 - 2
   7 - 4 + / 2
   ```

4. **缺少操作数**

   ```c
   8 * - / 3 + 6
   10 + 5 -
   15 * (3 +) - 4
   ```

5. **非法字符**

   ```c
   6 + 3 @ 5 - 2
   10 * #4 + 7
   ```

6. **连续的运算符**（不考虑正负号）

   ```c
   5 ++ 3 -- 2
   7 ** 2 + 4
   6 // 3 + 2
   ```

7. **十六进制格式错误**

   ```c
   0xG + 5 * 3
   10 + 0x1Z3 - 4
   0x12.5 + 6
   ```

8. **未匹配的括号和多余符号**

   ```c
   ((10 + 5) - 3 * 2)) + 4
   7 - (4 + (3 - 1) * 2) -
   ```

9. **十六进制与十进制混用**

   ```c
   0x10 + 5A - 20
   10 - 0xG + 3
   ```

10. **起始即为运算符**（不考虑解引用）

    ```c
    * 10 + 3 - 5
    / 7 + 8 * 2
    ```

11. **运算符结尾**

    ```c
    3 * 4 +
    7 - (5 + 2) *
    ```

12. **错误的负号和减号****（不考虑正负号）

    ```c
    5 - -3 + - * 4
    8 + --7 - 2
    10 - - - 5
    ```

## C语言转义字符

在C语言中，转义字符是以反斜杠`\`开头的特殊字符序列，用于表示非打印字符、特殊含义字符等。使用时需要注意以下几点：

### 常用转义字符

| 转义字符 | 含义                 |
| -------- | -------------------- |
| `\n`     | 换行符               |
| `\t`     | 水平制表符           |
| `\r`     | 回车符               |
| `\b`     | 退格符               |
| `\a`     | 响铃（警告）         |
| `\v`     | 垂直制表符           |
| `\f`     | 换页符               |
| `\'`     | 单引号               |
| `\"`     | 双引号               |
| `\\`     | 反斜杠               |
| `\?`     | 问号（避免`??`序列） |
| `\0`     | 空字符（NULL）       |
| `\xhh`   | 十六进制字符编码     |
| `\ooo`   | 八进制字符编码       |

### 1. **常见误用**

- **漏写反斜杠**：如写成`"Hello n"`而不是`"Hello\n"`, 会输出字符`n`而非换行。
- **多写反斜杠**：多余的`\`可能会造成编译错误或错误的输出。

### 2. **转义字符在字符串与字符常量中的区别**

- 字符串常量中的`\n`表示换行，`\'`、`\"`在字符串内有效。
- 在字符常量中，`'\'`后必须接有效转义字符才能编译。

### 3. **注意八进制和十六进制转义**

- **八进制`\ooo`**：以`0`开头，最多三位，例如`'\141'`表示`'a'`。
- **十六进制`\xhh`**：以`x`开头，可以连续使用多位，例如`"\x41\x42"`表示`"AB"`。

### 4. **与正则表达式和文件路径的混用**

- 在正则表达式中，需双重转义，如`\\d`表示数字。
- 文件路径中可以使用双反斜杠`\\`或前置`r`字符串常量（在C中需手动双反斜杠）。

### 5. **控制字符**

- `\a`、`\b`、`\r`、`\f`等控制字符在输出时需确保终端支持，尤其是`\a`可能引发提示音。

### 运算符优先级和结合性

| 优先级 | 运算符                                                  | 说明                                                         | 结合性 |
| ------ | ------------------------------------------------------- | ------------------------------------------------------------ | ------ |
| 1      | `()` `[]` `.` `->`                                      | 函数调用、数组下标、结构体成员访问、指针访问                 | 左到右 |
| 2      | `++` `--` `+` `-` `!` `~` `(type)` `*` `&`              | 后置递增、递减，正负号，逻辑非，按位取反，类型强制转换，指针取值与地址 | 右到左 |
| 3      | `*` `/` `%`                                             | 乘法、除法、取模                                             | 左到右 |
| 4      | `+` `-`                                                 | 加法、减法                                                   | 左到右 |
| 5      | `<<` `>>`                                               | 左移、右移                                                   | 左到右 |
| 6      | `<` `<=` `>` `>=`                                       | 小于、小于等于、大于、大于等于                               | 左到右 |
| 7      | `==` `!=`                                               | 等于、不等于                                                 | 左到右 |
| 8      | `&`                                                     | 按位与                                                       | 左到右 |
| 9      | `^`                                                     | 按位异或                                                     | 左到右 |
| 10     | `\|`                                                     | 按位或                                                       | 左到右 |
| 11     | `&&`                                                    | 逻辑与                                                       | 左到右 |
| 12     | `\|\|`                                                    | 逻辑或                                                       | 左到右 |
| 13     | `?:`                                                    | 条件运算符                                                   | 右到左 |
| 14     | `=` `+=` `-=` `*=` `/=` `%=` `&=` `\|=` `^=` `<<=` `>>=` | 赋值运算符与复合赋值运算符                                   | 右到左 |
| 15     | `,`                                                     | 逗号运算符                                                   | 左到右 |

1. **优先级1**：`()`、`[]`、`.`  
   - **运算符**：括号、数组下标、成员访问。
   - **结合性**：从左到右。
   - **说明**：函数调用和数组访问的优先级最高。

2. **优先级2**：`!`、`(正)`、`(负)`、`~`、`++`、`--`  
   - **运算符**：逻辑非、正号、负号、按位取反、自增、自减。
   - **结合性**：从右到左。
   - **说明**：一元操作符，如正负号、自增自减和按位取反，具有较高优先级。

3. **优先级3**：`*`、`/`、`%`  
   - **运算符**：乘法、除法、取模。
   - **结合性**：从左到右。
   - **说明**：基本的算术运算，高于加减法。

4. **优先级4**：`+`、`-`  
   - **运算符**：加法、减法。
   - **结合性**：从左到右。
   - **说明**：加减运算比乘除低，但高于位移运算。

5. **优先级5**：`<<`、`>>`  
   - **运算符**：左移、右移。
   - **结合性**：从左到右。
   - **说明**：位移运算优先级低于加减法。

6. **优先级6**：`<`、`<=`、`>`、`>=`、`instanceof`  
   - **运算符**：关系运算符，用于比较大小。
   - **结合性**：从左到右。
   - **说明**：优先级低于位移运算。

7. **优先级7**：`==`、`!=`  
   - **运算符**：等于、不等于。
   - **结合性**：从左到右。
   - **说明**：等于、不等于优先级低于关系运算符。

8. **优先级8**：`&`（按位与）  
   - **运算符**：按位与。
   - **结合性**：从左到右。
   - **说明**：低于等于、不等于。

9. **优先级9**：`^`（按位异或）  
   - **运算符**：按位异或。
   - **结合性**：从左到右。
   - **说明**：优先级低于按位与。

10. **优先级10**：`|`（按位或）  
    - **运算符**：按位或。
    - **结合性**：从左到右。
    - **说明**：优先级低于按位异或。

11. **优先级11**：`&&`（逻辑与）  
    - **运算符**：逻辑与。
    - **结合性**：从左到右。
    - **说明**：逻辑运算中，`&&`优先级高于`||`。

12. **优先级12**：`||`（逻辑或）  
    - **运算符**：逻辑或。
    - **结合性**：从左到右。
    - **说明**：`||`是逻辑运算的最低优先级。

13. **优先级13**：`?:`（三元运算符）  
    - **运算符**：条件运算符。
    - **结合性**：从右到左。
    - **说明**：用于条件表达式，如`a ? b : c`。

14. **优先级14**：赋值运算符：`= += -= *= /= %= &= |= ^= <<= >>=`  
    - **运算符**：赋值及复合赋值。
    - **结合性**：从右到左。
    - **说明**：赋值运算是最低优先级的运算之一。

## 逻辑非和按位取反

在C语言中，**逻辑非**（`!`）和**按位取反**（`~`）都是单目运算符，但它们的用途和作用对象不同。

### 1. 逻辑非（`!`）

逻辑非运算符 `!` 用于执行**布尔值运算**，对表达式的真假值进行取反。它主要用于条件判断，将非零值转换为 `0`，将 `0` 转换为 `1`。

#### 特性

- **作用对象**：应用于布尔值或整数表达式。
- **结果**：`0` 的逻辑非为 `1`，任何非零值的逻辑非为 `0`。
- **常用于条件判断**：可以用于将表达式的真假取反，比如在 `if` 和 `while` 语句中。

#### 例子

```c
int a = 5;
int b = 0;

printf("!a = %d\n", !a);  // 输出 0，因为 a 是非零值
printf("!b = %d\n", !b);  // 输出 1，因为 b 是零
```

在这个例子中：

- `!a` 的结果是 `0`，因为 `a` 是一个非零值。
- `!b` 的结果是 `1`，因为 `b` 是零。

### 2. 按位取反（`~`）

按位取反运算符 `~` 用于执行**按位运算**，对每一位进行取反操作，将 `0` 变成 `1`，`1` 变成 `0`。它通常用于整数操作，每一位取反后会生成一个新的二进制补码数。

#### 特性

- **作用对象**：应用于整数类型（如 `int`、`char`）。
- **结果**：对每一位逐位取反，`1` 变 `0`，`0` 变 `1`。
- **结果通常是负数**：由于 C 语言中的整数使用**二进制补码**表示，取反后往往会生成一个负数。

#### 例子

```c
int a = 5;      // 二进制：00000000 00000000 00000000 00000101
int b = ~a;     // 二进制：11111111 11111111 11111111 11111010

printf("a = %d\n", a);   // 输出 a = 5
printf("~a = %d\n", b);  // 输出 b = -6
```

在这个例子中：

- `a` 的值是 `5`，二进制表示为 `00000000 00000000 00000000 00000101`。
- `~a` 的值是 `-6`，因为 `5` 取反后变成 `11111111 11111111 11111111 11111010`，按二进制补码规则解读为 `-6`。

### 区别总结

| 运算符 | 名称     | 作用对象     | 功能                     | 示例               |
| ------ | -------- | ------------ | ------------------------ | ------------------ |
| `!`    | 逻辑非   | 布尔值、整数 | 将非零变 `0`，`0` 变 `1` | `!5` 的结果为 `0`  |
| `~`    | 按位取反 | 整数         | 对每一位取反             | `~5` 的结果为 `-6` |

### 用途场景

- **逻辑非 `!`**：主要用于条件判断，例如在 `if` 或 `while` 中取反判断。
- **按位取反 `~`**：主要用于位操作，例如在低级编程、掩码操作中用于取反。
