# 命令行环境(任务控制/tmux)

Complete later

可参见[missing-semester: 命令行环境](https://missing-semester-cn.github.io/)

---

## 任务控制与终端多路复用概述

在使用 Linux 和 macOS 这样的 Unix 系统时，任务控制与终端多路复用是高效管理多个终端会话和进程的关键工具。任务控制允许用户在同一终端中暂停、后台执行、恢复、终止程序，而终端多路复用工具（如 `tmux`）允许用户在一个物理终端中运行多个虚拟终端，实现会话的持久性管理。接下来将详细讲解这些概念及其基本操作。

### 1. 任务控制基础

任务控制主要通过 shell（如 Bash）进行管理，包括暂停、后台执行和恢复任务。以下是基本的任务控制操作：

#### 1.1 暂停和后台执行进程

在终端中执行程序时，程序通常会占用当前的终端界面，用户无法同时执行其他命令。为了管理这些前台任务，Linux 提供了任务控制功能：

- **暂停前台进程**：  
  使用 `Ctrl + Z` 可以将当前正在运行的前台进程暂停，使其进入后台的“暂停”状态。此时，进程不会继续执行，但用户可以继续使用终端。

- **后台执行进程**：  
  命令前加上 `&` 符号，直接让进程在后台运行，例如：
  ```bash
  command &
  ```
  此命令会将程序放入后台继续执行，而终端会立即返回，可以接受新的命令输入。

- **查看后台任务**：  
  使用 `jobs` 命令，可以查看当前终端中的所有后台任务：
  ```bash
  jobs
  ```
  输出中通常会显示任务的编号、状态（运行或暂停）以及命令。

- **将任务恢复到前台**：  
  使用 `fg` 命令将后台的任务恢复到前台。可以指定任务编号恢复某个特定的任务：
  ```bash
  fg %1
  ```
  上述命令将编号为 `1` 的后台任务恢复到前台。

#### 1.2 后台进程管理

- **继续运行暂停的后台任务**：  
  使用 `bg` 命令可以让暂停的后台任务继续执行：
  ```bash
  bg %1
  ```
  这会让编号为 `1` 的任务在后台继续运行。

- **终止进程**：  
  如果需要停止一个进程，可以使用 `kill` 命令。结合 `jobs` 命令获取的任务编号，可以终止后台运行的进程：
  ```bash
  kill %1
  ```

### 2. 终端多路复用（tmux）

`tmux`（Terminal Multiplexer）是一款功能强大的终端多路复用器，它允许用户在一个终端中运行多个会话、分屏管理以及后台执行程序，同时保持会话持久性。这意味着，即使断开 SSH 连接，程序仍然可以继续运行。

#### 2.1 安装 tmux

在大多数 Linux 发行版和 macOS 上，可以通过包管理器安装 `tmux`：
```bash
sudo apt-get install tmux  # Ubuntu/Debian
sudo yum install tmux      # CentOS/Fedora
brew install tmux          # macOS (Homebrew)
```

#### 2.2 启动 tmux 会话

使用 `tmux` 命令启动一个新的会话：
```bash
tmux
```
这将启动一个 tmux 会话，用户可以在该会话内运行多个终端窗口和面板。默认情况下，用户会被带入一个新的终端环境，类似于普通的 shell。

#### 2.3 tmux 的基本操作

- **创建新窗口**：  
  在 `tmux` 会话中，使用 `Ctrl + b`，然后按 `c` 创建一个新窗口。每个窗口相当于一个独立的终端。

- **在窗口之间切换**：  
  按 `Ctrl + b`，然后按数字键（如 `1` 或 `2`），可以快速在不同窗口之间切换。

- **分割窗口（分屏）**：  
  可以在一个窗口内进行分屏，水平或垂直分割当前窗口：
  - 水平分割：`Ctrl + b`，然后按 `%`
  - 垂直分割：`Ctrl + b`，然后按 `"`

- **切换面板**：  
  如果已经分割窗口，可以使用 `Ctrl + b`，然后按方向键来在不同面板之间切换。

- **后台执行 tmux 会话**：  
  如果需要暂时离开 `tmux`，可以使用 `Ctrl + b`，然后按 `d` 退出当前会话并保持后台运行。程序将继续在后台执行。

- **恢复 tmux 会话**：  
  可以使用 `tmux attach` 命令恢复先前退出的 `tmux` 会话：
  ```bash
  tmux attach
  ```

#### 2.4 管理多个会话

`tmux` 允许创建和管理多个会话，每个会话可以包含多个窗口和面板：

- **启动一个命名的会话**：  
  使用以下命令启动一个带有名称的 `tmux` 会话：
  ```bash
  tmux new -s mysession
  ```

- **列出会话**：  
  使用以下命令查看所有正在运行的 `tmux` 会话：
  ```bash
  tmux ls
  ```

- **切换到指定的会话**：  
  使用 `tmux attach -t <session-name>` 切换到指定的 `tmux` 会话：
  ```bash
  tmux attach -t mysession
  ```

- **终止会话**：  
  使用以下命令终止一个指定的 `tmux` 会话：
  ```bash
  tmux kill-session -t mysession
  ```

### 3. 使用场景

- **远程开发与调试**：  
  在通过 SSH 连接远程服务器时，可以通过 `tmux` 保持会话的持久性。即使断开 SSH 连接，程序仍然继续运行，当重新连接时，用户可以恢复原先的会话。

- **分屏多任务处理**：  
  `tmux` 的分屏功能允许在同一个终端中同时管理多个任务，例如查看日志、运行不同的命令或监控系统状态。

- **后台任务处理与切换**：  
  结合任务控制和 `tmux`，用户可以将长时间运行的任务放入后台，进行其他操作或完全退出终端，任务依然在后台执行，不会中断。

通过任务控制（如暂停和后台执行）和 `tmux`（终端多路复用），用户可以更加灵活地管理系统中的进程，尤其是在长时间任务运行、远程连接以及多任务处理的场景下。这些工具能够极大提升工作效率，并确保任务不会因为终端关闭或意外断开连接而中断。
